<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—á–µ—Ä–µ–¥—å –≤ –∫–ª–∞—Å—Å–µ</title>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 100%; 
            margin: 0; 
            padding: 10px; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh; 
            color: #4a5568; 
            line-height: 1.6;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; color: #805ad5; margin-bottom: 20px; font-size: 2.8em; font-weight: 300; text-shadow: 0 2px 4px rgba(128, 90, 213, 0.1); letter-spacing: -0.02em; }
        .queue-section { background: rgba(255, 255, 255, 0.95); margin: 15px 0; padding: 24px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); transition: all 0.2s ease; border: 1px solid rgba(128, 90, 213, 0.1); backdrop-filter: blur(10px); }
        .queue-section:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,0,0,0.12); }
        .queue-section h2 { color: #805ad5; margin-bottom: 18px; font-size: 1.6em; text-align: center; font-weight: 500; letter-spacing: -0.01em; text-shadow: 0 1px 2px rgba(128, 90, 213, 0.1); cursor: pointer; user-select: none; transition: color 0.2s ease; }
        .queue-section h2:hover { color: #6b46c1; }
        #toiletQueueSection h2::before { content: 'üöΩ '; }
        #boardQueueSection h2::before { content: 'üìã '; }
        .queue-list { 
            max-height: 0; 
            overflow: hidden; 
            transition: max-height 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.3s ease; /* –ë—ã—Å—Ç—Ä–µ–µ, 0.3s */
            opacity: 0;
        }
        .queue-list.show { 
            max-height: 800px; 
            opacity: 1;
        }
        .add-form { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 24px; align-items: center; }
        #nameInput { flex: 1; min-width: 150px; padding: 14px 16px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 16px; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); background: #fafafa; font-weight: 400; }
        #nameInput:focus { outline: none; border-color: #805ad5; box-shadow: 0 0 0 4px rgba(128, 90, 213, 0.1); background: white; transform: scale(1.02); }
        .select-queue { padding: 14px 16px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 16px; background: #fafafa; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); font-weight: 400; }
        .select-queue:focus { outline: none; border-color: #805ad5; box-shadow: 0 0 0 4px rgba(128, 90, 213, 0.1); transform: scale(1.02); }
        button { padding: 14px 24px; background: linear-gradient(135deg, #805ad5 0%, #9f7aea 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); min-width: 100px; letter-spacing: 0.5px; text-transform: uppercase; font-size: 14px; }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(128, 90, 213, 0.3); }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .queue-list { list-style: none; padding: 0; }
        .queue-list li { background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%); margin: 10px 0; padding: 18px; border-radius: 16px; display: flex; justify-content: space-between; align-items: center; animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards; opacity: 0; transform: scale(0.98); border-left: 4px solid #805ad5; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 2px 10px rgba(0,0,0,0.05); font-weight: 400; }
        .queue-list li:nth-child(even) { background: linear-gradient(135deg, #edf2f7 0%, #f7fafc 100%); }
        .queue-list li:hover { transform: scale(1.02); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        @keyframes fadeIn { to { opacity: 1; transform: scale(1); } }
        .queue-item-number { font-weight: 600; color: #805ad5; font-size: 1.2em; min-width: 30px; }
        .queue-item-name { flex: 1; margin-left: 12px; font-size: 1.1em; }
        .remove-btn { background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%); color: white; padding: 10px 14px; font-size: 14px; min-width: auto; border-radius: 8px; font-weight: 500; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .remove-btn:hover { box-shadow: 0 4px 15px rgba(245, 101, 101, 0.3); transform: translateY(-1px); }
        .remove-btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .status { text-align: center; margin: 10px 0; color: #805ad5; font-style: italic; font-weight: 500; font-size: 1.1em; transition: opacity 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        @media (max-width: 600px) { body { padding: 5px; } h1 { font-size: 2.2em; } .add-form { flex-direction: column; align-items: stretch; } #nameInput, .select-queue, button { width: 100%; } .queue-section { padding: 18px; margin: 10px 0; } .queue-list li { flex-direction: column; align-items: flex-start; gap: 12px; } .queue-item-name { margin-left: 0; } .queue-list.show { max-height: 1000px; } /* –ï—â—ë –±–æ–ª—å—à–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */ }
        @media (min-width: 601px) { .add-form { max-width: 500px; margin: 0 auto; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>–û—á–µ—Ä–µ–¥—å –≤ –∫–ª–∞—Å—Å–µ</h1>
        
        <div class="queue-section">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å</h2>
            <div class="add-form">
                <input type="text" id="nameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" required>
                <select id="queueSelect" class="select-queue">
                    <option value="toilet">–í —Ç—É–∞–ª–µ—Ç</option>
                    <option value="board">–ö –¥–æ—Å–∫–µ</option>
                    <option value="admin">–ê–¥–º–∏–Ω–∫–∞</option>
                </select>
                <button id="addToQueueBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            <div id="status" class="status"></div>
        </div>
        <div id="toiletQueueSection" class="queue-section">
            <h2 onclick="toggleQueue('toiletQueue')">–û—á–µ—Ä–µ–¥—å –≤ —Ç—É–∞–ª–µ—Ç</h2>
            <ul id="toiletQueue" class="queue-list"></ul>
        </div>
        <div id="boardQueueSection" class="queue-section">
            <h2 onclick="toggleQueue('boardQueue')">–û—á–µ—Ä–µ–¥—å –∫ –¥–æ—Å–∫–µ</h2>
            <ul id="boardQueue" class="queue-list"></ul>
        </div>
    </div>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è toggleQueue
        function toggleQueue(queueId) {
            const list = document.getElementById(queueId);
            list.classList.toggle('show');
        }

        const firebaseConfig = {
            apiKey: "AIzaSyAezFsKLHF2xUIqW2QZ4wRJtJ7vBaPy8TU",
            authDomain: "classqueue-39608.firebaseapp.com",
            databaseURL: "https://classqueue-39608-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "classqueue-39608",
            storageBucket: "classqueue-39608.firebasestorage.app",
            messagingSenderId: "777467342575",
            appId: "1:777467342575:web:8852d7ecf781116698351a",
            measurementId: "G-Q05Z2EH3KM"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const nameInput = document.getElementById('nameInput');
        const queueSelect = document.getElementById('queueSelect');
        const addToQueueBtn = document.getElementById('addToQueueBtn');
        const toiletQueueList = document.getElementById('toiletQueue');
        const boardQueueList = document.getElementById('boardQueue');
        const statusDiv = document.getElementById('status');

        // –ó–≤—É–∫–∏ (base64 –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º)
        const addSound = new Audio('data:audio/wav;base64,UklGRl9vAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YaNAAAD//wIAAP////8AAP////8='); // –ö–æ—Ä–æ—Ç–∫–∏–π beep
        const removeSound = new Audio('data:audio/wav;base64,UklGRl9vAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YaNAAAD//wIAAP////8AAP////8='); // –¢–æ—Ç –∂–µ beep –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã

        // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è localStorage
        let userId = localStorage.getItem('userId');
        if (!userId) {
            userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('userId', userId);
        }

        let toiletQueueRef = database.ref('toiletQueue');
        let boardQueueRef = database.ref('boardQueue');

        // –†–µ–∂–∏–º –∞–¥–º–∏–Ω–∞
        let isAdmin = localStorage.getItem('isAdmin') === 'true';
        const ADMIN_PASSWORD = 'hssoio####';

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å—å –æ—Ç —ç—Ç–æ–≥–æ userId —É–∂–µ –≤ –æ—á–µ—Ä–µ–¥–∏
        function hasUserInQueue(queueRef) {
            return new Promise((resolve) => {
                queueRef.once('value', (snapshot) => {
                    let hasEntry = false;
                    snapshot.forEach((child) => {
                        if (child.val().userId === userId) {
                            hasEntry = true;
                        }
                    });
                    resolve(hasEntry);
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –æ—á–µ—Ä–µ–¥–∏
        function updateQueueList(queueSnapshot, listElement) {
            listElement.innerHTML = '';
            let index = 0;
            queueSnapshot.forEach((childSnapshot) => {
                const data = childSnapshot.val();
                const key = childSnapshot.key;
                const num = ++index;  // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è –æ—Ç 1
                const li = document.createElement('li');
                li.innerHTML = `<span class="queue-item-number">${num}.</span> <span class="queue-item-name">${data.name}</span>`;
                const btn = document.createElement('button');
                btn.className = 'remove-btn';
                btn.textContent = '–£–±—Ä–∞—Ç—å';
                if (isAdmin || data.userId === userId) {
                    btn.onclick = () => {
                        removeSound.play().catch(() => {}); // –ü—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º –∑–≤—É–∫ —É–¥–∞–ª–µ–Ω–∏—è
                        removeFromQueue(listElement.id, key);
                    };
                } else {
                    btn.disabled = true;
                    btn.title = '–ù–µ –≤–∞—à –≤—Ö–æ–¥';
                }
                li.appendChild(btn);
                li.style.animationDelay = `${(index - 1) * 0.12}s`;
                listElement.appendChild(li);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏
        window.removeFromQueue = function(listId, key) {
            if (listId === 'toiletQueue') {
                toiletQueueRef.child(key).remove();
            } else if (listId === 'boardQueue') {
                boardQueueRef.child(key).remove();
            }
        };

        // –°–ª—É—à–∞—Ç–µ–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        toiletQueueRef.on('value', (snapshot) => {
            updateQueueList(snapshot, toiletQueueList);
        });
        boardQueueRef.on('value', (snapshot) => {
            updateQueueList(snapshot, boardQueueList);
        });

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
        addToQueueBtn.addEventListener('click', async () => {
            const name = nameInput.value.trim();
            if (name) {
                const selectedQueue = queueSelect.value;
                if (selectedQueue === 'admin') {
                    if (name === ADMIN_PASSWORD) {
                        isAdmin = true;
                        localStorage.setItem('isAdmin', 'true');
                        statusDiv.textContent = '–ê–¥–º–∏–Ω —Ä–µ–∂–∏–º –≤–∫–ª—é—á—ë–Ω!';
                        addSound.play().catch(() => {}); // –ó–≤—É–∫ –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∫–∏
                        setTimeout(() => { statusDiv.textContent = ''; }, 2000);
                    } else {
                        statusDiv.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!';
                        setTimeout(() => { statusDiv.textContent = ''; }, 2000);
                    }
                    nameInput.value = '';
                    return;
                }
                const queueRef = selectedQueue === 'toilet' ? toiletQueueRef : boardQueueRef;
                const hasEntry = await hasUserInQueue(queueRef);
                if (hasEntry && !isAdmin) {  // –ê–¥–º–∏–Ω—É –º–æ–∂–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å
                    statusDiv.textContent = '–í—ã —É–∂–µ –≤ —ç—Ç–æ–π –æ—á–µ—Ä–µ–¥–∏!';
                    setTimeout(() => { statusDiv.textContent = ''; }, 2000);
                    return;
                }
                addToQueueBtn.disabled = true;
                statusDiv.textContent = '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...';
                const entry = { name: name, userId: userId, timestamp: Date.now() };
                queueRef.push(entry).then(() => {
                    statusDiv.textContent = '–î–æ–±–∞–≤–ª–µ–Ω–æ!';
                    addSound.play().catch(() => {}); // –ó–≤—É–∫ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏
                    setTimeout(() => { statusDiv.textContent = ''; }, 2000);
                    nameInput.value = '';
                    nameInput.focus();
                }).catch((error) => {
                    statusDiv.textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                }).finally(() => {
                    addToQueueBtn.disabled = false;
                });
            }
        });

        // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Enter
        nameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addToQueueBtn.click();
            }
        });
    </script>
</body>
</html>
