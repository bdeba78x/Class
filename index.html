<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—á–µ—Ä–µ–¥—å –≤ –∫–ª–∞—Å—Å–µ</title>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 100%; margin: 0; padding: 10px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; color: #4a5568; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; color: #805ad5; margin-bottom: 20px; font-size: 2.5em; font-weight: 300; }
        .queue-section { background: white; margin: 15px 0; padding: 20px; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); transition: all 0.3s ease; border: 1px solid rgba(128, 90, 213, 0.1); }
        .queue-section:hover { transform: translateY(-1px); box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .queue-section h2 { color: #805ad5; margin-bottom: 15px; font-size: 1.4em; text-align: center; font-weight: 400; }
        #toiletQueueSection h2::before { content: 'üöΩ '; }
        #boardQueueSection h2::before { content: 'üìã '; }
        .add-form { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; align-items: center; }
        #nameInput { flex: 1; min-width: 150px; padding: 12px 15px; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 16px; transition: all 0.3s ease; background: #fafafa; }
        #nameInput:focus { outline: none; border-color: #805ad5; box-shadow: 0 0 0 3px rgba(128, 90, 213, 0.1); background: white; }
        .select-queue { padding: 12px 15px; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 16px; background: #fafafa; transition: all 0.3s ease; }
        .select-queue:focus { outline: none; border-color: #805ad5; box-shadow: 0 0 0 3px rgba(128, 90, 213, 0.1); }
        button { padding: 12px 20px; background: linear-gradient(135deg, #805ad5 0%, #9f7aea 100%); color: white; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.3s ease; min-width: 100px; }
        button:hover { transform: translateY(-1px); box-shadow: 0 3px 10px rgba(128, 90, 213, 0.2); }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .queue-list { list-style: none; padding: 0; }
        .queue-list li { background: #f7fafc; margin: 8px 0; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; animation: fadeIn 0.5s ease forwards; opacity: 0; transform: scale(0.95); border-left: 3px solid #805ad5; transition: all 0.3s ease; }
        .queue-list li:nth-child(even) { background: #edf2f7; }
        .queue-list li:hover { transform: scale(1.01); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        @keyframes fadeIn { to { opacity: 1; transform: scale(1); } }
        .queue-item-number { font-weight: 600; color: #805ad5; font-size: 1.1em; }
        .queue-item-name { flex: 1; margin-left: 10px; }
        .remove-btn { background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%); color: white; padding: 8px 12px; font-size: 14px; min-width: auto; border-radius: 6px; }
        .remove-btn:hover { box-shadow: 0 3px 10px rgba(245, 101, 101, 0.2); }
        .remove-btn:disabled { background: #ccc; cursor: not-allowed; }
        .status { text-align: center; margin: 10px 0; color: #805ad5; font-style: italic; }
        .lang-selector { text-align: center; margin-bottom: 20px; }
        .lang-selector select { padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 16px; }
        @media (max-width: 600px) { body { padding: 5px; } h1 { font-size: 2em; } .add-form { flex-direction: column; align-items: stretch; } #nameInput, .select-queue, button { width: 100%; } .queue-section { padding: 15px; margin: 10px 0; } .queue-list li { flex-direction: column; align-items: flex-start; gap: 10px; } .queue-item-name { margin-left: 0; } }
        @media (min-width: 601px) { .add-form { max-width: 500px; margin: 0 auto; } }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="title">–û—á–µ—Ä–µ–¥—å –≤ –∫–ª–∞—Å—Å–µ</h1>
        
        <div class="lang-selector">
            <select id="langSelect">
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="uk">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
            </select>
        </div>
        
        <div class="queue-section">
            <h2 id="addTitle">–î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å</h2>
            <div class="add-form">
                <input type="text" id="nameInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" required>
                <select id="queueSelect" class="select-queue">
                    <option value="toilet">–í —Ç—É–∞–ª–µ—Ç</option>
                    <option value="board">–ö –¥–æ—Å–∫–µ</option>
                </select>
                <button id="addToQueueBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            <div id="status" class="status"></div>
        </div>
        <div id="toiletQueueSection" class="queue-section">
            <h2>–û—á–µ—Ä–µ–¥—å –≤ —Ç—É–∞–ª–µ—Ç</h2>
            <ul id="toiletQueue" class="queue-list"></ul>
        </div>
        <div id="boardQueueSection" class="queue-section">
            <h2>–û—á–µ—Ä–µ–¥—å –∫ –¥–æ—Å–∫–µ</h2>
            <ul id="boardQueue" class="queue-list"></ul>
        </div>
    </div>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAezFsKLHF2xUIqW2QZ4wRJtJ7vBaPy8TU",
            authDomain: "classqueue-39608.firebaseapp.com",
            databaseURL: "https://classqueue-39608-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "classqueue-39608",
            storageBucket: "classqueue-39608.firebasestorage.app",
            messagingSenderId: "777467342575",
            appId: "1:777467342575:web:8852d7ecf781116698351a",
            measurementId: "G-Q05Z2EH3KM"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const nameInput = document.getElementById('nameInput');
        const queueSelect = document.getElementById('queueSelect');
        const addToQueueBtn = document.getElementById('addToQueueBtn');
        const toiletQueueList = document.getElementById('toiletQueue');
        const boardQueueList = document.getElementById('boardQueue');
        const statusDiv = document.getElementById('status');

        // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è localStorage
        let userId = localStorage.getItem('userId');
        if (!userId) {
            userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('userId', userId);
        }

        let toiletQueueRef = database.ref('toiletQueue');
        let boardQueueRef = database.ref('boardQueue');

        // –¢–µ–∫—Å—Ç—ã –Ω–∞ –¥–≤—É—Ö —è–∑—ã–∫–∞—Ö
        const translations = {
            ru: {
                title: '–û—á–µ—Ä–µ–¥—å –≤ –∫–ª–∞—Å—Å–µ',
                addTitle: '–î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å',
                namePlaceholder: '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è',
                toiletOption: '–í —Ç—É–∞–ª–µ—Ç',
                boardOption: '–ö –¥–æ—Å–∫–µ',
                addButton: '–î–æ–±–∞–≤–∏—Ç—å',
                toiletQueueTitle: '–û—á–µ—Ä–µ–¥—å –≤ —Ç—É–∞–ª–µ—Ç',
                boardQueueTitle: '–û—á–µ—Ä–µ–¥—å –∫ –¥–æ—Å–∫–µ',
                removeButton: '–£–±—Ä–∞—Ç—å',
                notYourEntry: '–ù–µ –≤–∞—à –≤—Ö–æ–¥',
                adding: '–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...',
                added: '–î–æ–±–∞–≤–ª–µ–Ω–æ!',
                alreadyInQueue: '–í—ã —É–∂–µ –≤ —ç—Ç–æ–π –æ—á–µ—Ä–µ–¥–∏!',
                error: '–û—à–∏–±–∫–∞: '
            },
            uk: {
                title: '–ß–µ—Ä–≥–∞ –≤ –∫–ª–∞—Å—ñ',
                addTitle: '–î–æ–¥–∞—Ç–∏ –¥–æ —á–µ—Ä–≥–∏',
                namePlaceholder: '–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º\'—è',
                toiletOption: '–î–æ —Ç—É–∞–ª–µ—Ç—É',
                boardOption: '–î–æ –¥–æ—à–∫–∏',
                addButton: '–î–æ–¥–∞—Ç–∏',
                toiletQueueTitle: '–ß–µ—Ä–≥–∞ –¥–æ —Ç—É–∞–ª–µ—Ç—É',
                boardQueueTitle: '–ß–µ—Ä–≥–∞ –¥–æ –¥–æ—à–∫–∏',
                removeButton: '–í–∏–¥–∞–ª–∏—Ç–∏',
                notYourEntry: '–ù–µ –≤–∞—à –∑–∞–ø–∏—Å',
                adding: '–î–æ–¥–∞–≤–∞–Ω–Ω—è...',
                added: '–î–æ–¥–∞–Ω–æ!',
                alreadyInQueue: '–í–∏ –≤–∂–µ –≤ —Ü—ñ–π —á–µ—Ä–∑—ñ!',
                error: '–ü–æ–º–∏–ª–∫–∞: '
            }
        };

        let currentLang = localStorage.getItem('lang') || 'ru';

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            document.documentElement.lang = lang;
            document.getElementById('title').textContent = translations[lang].title;
            document.getElementById('addTitle').textContent = translations[lang].addTitle;
            document.getElementById('nameInput').placeholder = translations[lang].namePlaceholder;
            document.querySelector('#queueSelect option[value="toilet"]').textContent = translations[lang].toiletOption;
            document.querySelector('#queueSelect option[value="board"]').textContent = translations[lang].boardOption;
            document.getElementById('addToQueueBtn').textContent = translations[lang].addButton;
            document.querySelector('#toiletQueueSection h2').textContent = translations[lang].toiletQueueTitle;
            document.querySelector('#boardQueueSection h2').textContent = translations[lang].boardQueueTitle;
            // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –≤ –æ—á–µ—Ä–µ–¥—è—Ö (–ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞)
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —è–∑—ã–∫–∞
        setLanguage(currentLang);

        // –°–º–µ–Ω–∞ —è–∑—ã–∫–∞
        document.getElementById('langSelect').value = currentLang;
        document.getElementById('langSelect').addEventListener('change', (e) => {
            setLanguage(e.target.value);
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å—å –æ—Ç —ç—Ç–æ–≥–æ userId —É–∂–µ –≤ –æ—á–µ—Ä–µ–¥–∏
        function hasUserInQueue(queueRef) {
            return new Promise((resolve) => {
                queueRef.once('value', (snapshot) => {
                    let hasEntry = false;
                    snapshot.forEach((child) => {
                        if (child.val().userId === userId) {
                            hasEntry = true;
                        }
                    });
                    resolve(hasEntry);
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –æ—á–µ—Ä–µ–¥–∏
        function updateQueueList(queueSnapshot, listElement) {
            listElement.innerHTML = '';
            let index = 0;
            queueSnapshot.forEach((childSnapshot) => {
                const data = childSnapshot.val();
                const key = childSnapshot.key;
                const num = ++index;  // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è –æ—Ç 1
                const li = document.createElement('li');
                li.innerHTML = `<span class="queue-item-number">${num}.</span> <span class="queue-item-name">${data.name}</span>`;
                const btn = document.createElement('button');
                btn.className = 'remove-btn';
                btn.textContent = translations[currentLang].removeButton;
                if (data.userId === userId) {
                    btn.onclick = () => removeFromQueue(listElement.id, key);
                } else {
                    btn.disabled = true;
                    btn.title = translations[currentLang].notYourEntry;
                }
                li.appendChild(btn);
                li.style.animationDelay = `${(index - 1) * 0.1}s`;
                listElement.appendChild(li);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏
        window.removeFromQueue = function(listId, key) {
            if (listId === 'toiletQueue') {
                toiletQueueRef.child(key).remove();
            } else if (listId === 'boardQueue') {
                boardQueueRef.child(key).remove();
            }
        };

        // –°–ª—É—à–∞—Ç–µ–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        toiletQueueRef.on('value', (snapshot) => {
            updateQueueList(snapshot, toiletQueueList);
        });
        boardQueueRef.on('value', (snapshot) => {
            updateQueueList(snapshot, boardQueueList);
        });

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
        addToQueueBtn.addEventListener('click', async () => {
            const name = nameInput.value.trim();
            if (name) {
                const selectedQueue = queueSelect.value;
                const queueRef = selectedQueue === 'toilet' ? toiletQueueRef : boardQueueRef;
                const hasEntry = await hasUserInQueue(queueRef);
                if (hasEntry) {
                    statusDiv.textContent = translations[currentLang].alreadyInQueue;
                    setTimeout(() => { statusDiv.textContent = ''; }, 2000);
                    return;
                }
                addToQueueBtn.disabled = true;
                statusDiv.textContent = translations[currentLang].adding;
                const entry = { name: name, userId: userId, timestamp: Date.now() };
                queueRef.push(entry).then(() => {
                    statusDiv.textContent = translations[currentLang].added;
                    setTimeout(() => { statusDiv.textContent = ''; }, 2000);
                    nameInput.value = '';
                    nameInput.focus();
                }).catch((error) => {
                    statusDiv.textContent = translations[currentLang].error + error.message;
                }).finally(() => {
                    addToQueueBtn.disabled = false;
                });
            }
        });

        // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Enter
        nameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addToQueueBtn.click();
            }
        });
    </script>
</body>
</html>